import subprocess
from os import walk
import shutil
from tkinter import COMMAND

SOURCE_FOLDER = "D:\\adwareDir\\Banking\\Banking" 
RUN_FOLDER = "D:\\adwareDir\\Banking\\Banking\\run" 
DONE_FOLDER = "D:\\adwareDir\\Banking\Banking\\done" 
ERROR_FOLDER = "D:\\adwareDir\\Banking\Banking\\error" 
DOCKER_IMAGE = "af9f1e19a92404f1f60d24dafb4176cb885e06279931993a044b38766c82c556"
COMMAND = 'docker start -a -i ' + DOCKER_IMAGE

def run_docker(file_name):
    try:
        # Chạy phân tích 1 file apk
        subprocess.check_output(COMMAND, shell=True)

        # Move file đã phân tích thành công sang thư mục DONE_FOLDER
        old_path = RUN_FOLDER + "\\samples\\" + file_name
        new_path = DONE_FOLDER + "\\" + file_name
        shutil.move(old_path, new_path)
    except:
        # Move file phân lỗi vào rhuw mục ERROR_FOLDER
        old_path = RUN_FOLDER + "\\samples\\" + file_name
        new_path = ERROR_FOLDER + "\\" + file_name
        shutil.move(old_path, new_path)

sources = next(walk(SOURCE_FOLDER), (None, None, []))[2] #Lấy các files trong thư mục sources
for file_name in sources:
    print(file_name)
    # Move 1 file ở SOURCE_FOLDER sang RUN_FOLDER để phân tích
    old_path = SOURCE_FOLDER + "\\" + file_name
    new_path = RUN_FOLDER + "\\" + file_name
    shutil.move(old_path, new_path)
    run_docker(file_name)